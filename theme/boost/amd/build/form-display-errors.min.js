define(["jquery","core_form/events"],function($,FormEvent){let focusedAlready=false;return{enhance:function(elementid){var element=document.getElementById(elementid);if(!element){return}element.addEventListener(FormEvent.eventTypes.formFieldValidationFailed,e=>{const msg=e.detail.message;e.preventDefault();var parent=$(element).closest(".fitem");var feedback=parent.find(".form-control-feedback");const feedbackId=feedback.attr("id");let describedBy=$(element).attr("aria-describedby");if(typeof describedBy==="undefined"){describedBy=""}let describedByIds=[];if(describedBy.length){describedByIds=describedBy.split(" ")}const feedbackIndex=describedByIds.indexOf(feedbackId);if($(element).prop("tagName")=="TEXTAREA"&&parent.find("[contenteditable]").length>0){element=parent.find("[contenteditable]")}if(msg!==""){parent.addClass("has-danger");parent.data("client-validation-error",true);$(element).addClass("is-invalid");if(feedbackIndex===-1){describedByIds.push(feedbackId);$(element).attr("aria-describedby",describedByIds.join(" "))}$(element).attr("aria-invalid",true);feedback.html(msg);feedback.show();if(!focusedAlready){element.scrollIntoView({behavior:"smooth",block:"center"});focusedAlready=true;setTimeout(()=>{element.focus({preventScroll:true});focusedAlready=false},0)}}else{if(parent.data("client-validation-error")===true){parent.removeClass("has-danger");parent.data("client-validation-error",false);$(element).removeClass("is-invalid");if(feedbackIndex>-1){describedByIds.splice(feedbackIndex,1)}if(describedByIds.length){describedBy=describedByIds.join(" ");$(element).attr("aria-describedby",describedBy)}else{$(element).removeAttr("aria-describedby")}$(element).attr("aria-invalid",false);feedback.hide()}}});var form=element.closest("form");if(form&&!("boostFormErrorsEnhanced"in form.dataset)){form.addEventListener("submit",function(){var visibleError=$(".form-control-feedback:visible");if(visibleError.length){visibleError[0].focus()}});form.dataset.boostFormErrorsEnhanced=1}}}});