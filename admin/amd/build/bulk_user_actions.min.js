import*as reportSelectors from"core_reportbuilder/local/selectors";import*as tableEvents from"core_table/local/dynamic/events";import*as FormChangeChecker from"core_form/changechecker";import*as CustomEvents from"core/custom_interaction_events";import jQuery from"jquery";const Selectors={bulkActionsForm:"form#user-bulk-action-form",userReportWrapper:'[data-region="report-user-list-wrapper"]',checkbox:'input[type="checkbox"][data-togglegroup="report-select-all"][data-toggle="slave"]',masterCheckbox:'input[type="checkbox"][data-togglegroup="report-select-all"][data-toggle="master"]',checkedRows:'[data-togglegroup="report-select-all"][data-toggle="slave"]:checked'};export const init=()=>{const userBulkForm=document.querySelector(Selectors.bulkActionsForm);const userReport=userBulkForm?.closest(Selectors.userReportWrapper)?.querySelector(reportSelectors.regions.report);if(!userBulkForm||!userReport){return}const actionSelect=userBulkForm.querySelector("select");CustomEvents.define(actionSelect,[CustomEvents.events.accessibleChange]);jQuery(actionSelect).on(CustomEvents.events.accessibleChange,event=>{if(event.target.value&&`${event.target.value}`!=="0"){const e=new Event("submit",{cancelable:true});userBulkForm.dispatchEvent(e);if(!e.defaultPrevented){FormChangeChecker.markFormSubmitted(userBulkForm);userBulkForm.submit()}}});const updateUserIds=()=>{const selectedUsers=[...userReport.querySelectorAll(Selectors.checkedRows)];const selectedUserIds=selectedUsers.map(check=>parseInt(check.value));userBulkForm.querySelector('[name="userids"]').value=selectedUserIds.join(",");actionSelect.disabled=selectedUsers.length===0;const selectedUsersNames=selectedUsers.map(check=>document.querySelector(`label[for="${check.id}"]`).textContent);userBulkForm.data={userids:selectedUserIds,usernames:selectedUsersNames}};updateUserIds();document.addEventListener("change",event=>{if((event.target.matches(Selectors.checkbox)||event.target.matches(Selectors.masterCheckbox))&&userReport.contains(event.target)){updateUserIds()}});document.addEventListener(tableEvents.tableContentRefreshed,event=>{if(userReport.contains(event.target)){updateUserIds()}})};