import ModalEvents from"core/modal_events";import ModalSaveCancel from"core/modal_save_cancel";import Notification from"core/notification";import{getString}from"core/str";import Url from"core/url";import Fragment from"core/fragment";import*as Prefetch from"core/prefetch";const SELECTORS={ACTION:".mfa-action-button"};export const init=contextId=>{Prefetch.prefetchStrings("tool_mfa",["yesremove","yesreplace"]);registerEventListeners(contextId)};const registerEventListeners=contextId=>{document.addEventListener("click",e=>{const action=e.target.closest(SELECTORS.ACTION);if(action){buildModal(action,contextId).catch(Notification.exception)}})};const buildModal=async(element,contextId)=>{const data={action:element.getAttribute("data-action"),factor:element.getAttribute("data-factor"),factorid:element.getAttribute("data-factorid"),devicename:element.getAttribute("data-devicename"),actionurl:Url.relativeUrl("/admin/tool/mfa/action.php")};if(data.action==="revoke"){data.title=await getString("revokefactorconfirmation","factor_"+data.factor,data.devicename);data.buttontext=await getString("yesremove","tool_mfa")}else if(data.action==="replace"){data.title=await getString("replacefactorconfirmation","factor_"+data.factor,data.devicename);data.buttontext=await getString("yesreplace","tool_mfa")}const modal=await ModalSaveCancel.create({title:data.title,body:Fragment.loadFragment("tool_mfa","factor_action_confirmation_form",contextId,data),show:true,buttons:{save:data.buttontext,cancel:getString("cancel","moodle")}});modal.getRoot().on(ModalEvents.save,()=>{modal.getRoot().find("form").submit()})};