define(["factor_webauthn/utils","core/log"],function(utils,Log){async function registerSecurityKey(createArgs){try{if(!navigator.credentials||!navigator.credentials.create){throw new Error("Browser not supported.")}if(createArgs.success===false){throw new Error(createArgs.msg||"unknown error occurred")}utils.recursiveBase64StrToArrayBuffer(createArgs);const cred=await navigator.credentials.create(createArgs);const authenticatorResponse={transports:cred.response.getTransports?cred.response.getTransports():null,clientDataJSON:cred.response.clientDataJSON?utils.arrayBufferToBase64(cred.response.clientDataJSON):null,attestationObject:cred.response.attestationObject?utils.arrayBufferToBase64(cred.response.attestationObject):null};document.getElementById("id_response_input").value=JSON.stringify(authenticatorResponse);document.getElementById("id_submitbutton").disabled=false}catch(e){Log.debug("The request timed out or you have canceled the request. Please try again later.")}}return{init:function(createArgs){document.getElementById("id_submitbutton").disabled=true;createArgs=JSON.parse(createArgs);document.getElementById("factor_webauthn-register").addEventListener("click",function(){registerSecurityKey(createArgs)});document.getElementById("factor_webauthn-register").addEventListener("keypress",function(){registerSecurityKey(createArgs)})}}});